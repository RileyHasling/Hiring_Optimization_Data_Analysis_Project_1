---
title: "Hiring Optimization 1"
output: html_document
date: "2025-09-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#dataframes
```{r}
file.choose()
```

```{r}
e_2020 <- read.csv("C:\\Users\\riley\\OneDrive\\Desktop\\Detailed Occupation, 2020.csv")
```

```{r}
e_2021 <- read.csv("C:\\Users\\riley\\OneDrive\\Desktop\\Detailed Occupation, 2021.csv")
```

```{r}
e_2022 <- read.csv("C:\\Users\\riley\\OneDrive\\Desktop\\Detailed Occupation, 2022.csv")
```

```{r}
e_2023 <- read.csv("C:\\Users\\riley\\OneDrive\\Desktop\\Detailed Occupation, 2023.csv")
```

```{r}
e_2024 <- read.csv("C:\\Users\\riley\\OneDrive\\Desktop\\Detailed Occupation, 2024.csv")
```

#packages
```{r}
install.packages("tidyverse")
install.packages("dplyr")
```

```{r}
library(tidyverse)
library(dplyr)
```

#cleaning

##remove headers
```{r}
remove_header <- function(e_2020) {
  e_2020[-c(1:7), ]
}

e_2020 <- remove_header(e_2020)
e_2021 <- remove_header(e_2021)
e_2022 <- remove_header(e_2022)
e_2023 <- remove_header(e_2023)
e_2024 <- remove_header(e_2024)
```

##rename columns
```{r}
rename_col <- function(e_2020) {
  names(e_2020)[1] <- "occupation"
  names(e_2020)[2] <- "total"
  return(e_2020)
}

e_2020 <- rename_col(e_2020)
e_2021 <- rename_col(e_2021)
e_2022 <- rename_col(e_2022)
e_2023 <- rename_col(e_2023)
e_2024 <- rename_col(e_2024)
```

##remove unnesessary columns
```{r}
remove_col <- function(e_2020) {
  e_2020[,-(3:10)]
}

e_2020 <- remove_col(e_2020)
e_2021 <- remove_col(e_2021)
e_2022 <- remove_col(e_2022)
e_2023 <- remove_col(e_2023)
e_2024 <- remove_col(e_2024)
```

##combine dataframes
```{r}
e_combined <- reduce(
  list(e_2020, e_2021, e_2022, e_2023, e_2024),
  dplyr::full_join,
  by = "occupation"
)
```

##fix NA values
```{r}
e_combined[1, "total.y"] = 64744
e_combined[1, "total.x.x"] = 68099
e_combined[1, "total"] = 70744
```

##rename total columns
```{r}
rename_total <- function(e_combined) {
  names(e_combined)[2] <- "total_2020"
  names(e_combined)[3] <- "total_2021"
  names(e_combined)[4] <- "total_2022"
  names(e_combined)[5] <- "total_2023"
  names(e_combined)[6] <- "total_2024"
  return(e_combined)
}

e_combined <- rename_total(e_combined)
```

##fix total class
```{r}
e_combined$total_2020 <- as.numeric(e_combined$total_2020)
e_combined$total_2021 <- as.numeric(e_combined$total_2021)
e_combined$total_2022 <- as.numeric(e_combined$total_2022)
e_combined$total_2023 <- as.numeric(e_combined$total_2023)
e_combined$total_2024 <- as.numeric(e_combined$total_2024)
```

#OPV averages from 2020 to 2024 for common professions in a business

##OPV from 2020 to 2021

###"Management, business, and financial operations occupations" 20-21, OPV: 0.0262
```{r}
MBF_2020 <- e_combined %>% 
  filter(occupation == "Management, business, and financial operations occupations") %>% 
  select(total_2020)

MBF_2021 <- e_combined %>% 
  filter(occupation == "Management, business, and financial operations occupations") %>% 
  select(total_2021)

MBF_avg_1 <- (MBF_2021+MBF_2020)/2

MBF_opv_1 <- (MBF_2021-MBF_2020)/MBF_avg_1

print(MBF_opv_1)
```

###function to get OPV
```{r}
get_opv <- function(data, occupation, year1, year2) {
  
  col1 <- paste0("total_", year1)
  col2 <- paste0("total_", year2)
  
  values <- data %>%
    filter(occupation == !!occupation) %>%
    select(all_of(c(col1, col2)))
  
  val1 <- pull(values, col1)
  val2 <- pull(values, col2)
  
  avg <- (val1 + val2) / 2
  opv <- (val2 - val1) / avg
  
  return(opv)
}
```

```{r}
MBF_opv_1 <- get_opv(e_combined, "Management, business, and financial operations occupations", 2020, 2021)
```

###"Sales and related occupations" 20-21, OPV: 0.0141
```{r}
SRO_opv_1 <- get_opv(e_combined, "Sales and related occupations", 2020, 2021)
```

###"Architecture and engineering occupations" 20-21, OPV: 0.0206
```{r}
AEO_opv_1 <- get_opv(e_combined, "Architecture and engineering occupations", 2020, 2021)
```

###"Life, physical, and social science occupations" 20-21, OPV: 0.0080
```{r}
LPS_opv_1 <- get_opv(e_combined, "Life, physical, and social science occupations", 2020, 2021)
```

###"Lawyers" 20-21, OPV: -0.0864
```{r}
LAW_opv_1 <- get_opv(e_combined, "Lawyers", 2020, 2021)
```

###"Production, transportation, and material moving occupations" 20-21, OPV: 0.0583
```{r}
PTM_opv_1 <- get_opv(e_combined, "Production, transportation, and material moving occupations", 2020, 2021)
```

##OPV from 2021 to 2022

###"Management, business, and financial operations occupations" 21-22, OPV: 0.0519
```{r}
MBF_opv_2 <- get_opv(e_combined, "Management, business, and financial operations occupations", 2021, 2022)
```

###"Sales and related occupations" 21-22, OPV: -0.0037
```{r}
SRO_opv_2 <- get_opv(e_combined, "Sales and related occupations", 2021, 2022)
```

###"Architecture and engineering occupations" 21-22, OPV: 0.0684
```{r}
AEO_opv_2 <- get_opv(e_combined, "Architecture and engineering occupations", 2021, 2022)
```

###"Life, physical, and social science occupations" 21-22, OPV: 0.1149
```{r}
LPS_opv_2 <- get_opv(e_combined, "Life, physical, and social science occupations", 2021, 2022)
```

###"Lawyers" 21-22, OPV: 0.0503
```{r}
LAW_opv_2 <- get_opv(e_combined, "Lawyers", 2021, 2022)
```

###"Production, transportation, and material moving occupations" 21-22, OPV: 0.0392
```{r}
PTM_opv_2 <- get_opv(e_combined, "Production, transportation, and material moving occupations", 2021, 2022)
```

##OPV from 2022 to 2023

###"Management, business, and financial operations occupations" 22-23, OPV: 0.0399
```{r}
MBF_opv_3 <- get_opv(e_combined, "Management, business, and financial operations occupations", 2022, 2023)
```

###"Sales and related occupations" 22-23, OPV: 0.0006
```{r}
SRO_opv_3 <- get_opv(e_combined, "Sales and related occupations", 2022, 2023)
```

###"Architecture and engineering occupations" 22-23, OPV: 0.0391
```{r}
AEO_opv_3 <- get_opv(e_combined, "Architecture and engineering occupations", 2022, 2023)
```

###"Life, physical, and social science occupations" 22-23, OPV: 0.0162
```{r}
LPS_opv_3 <- get_opv(e_combined, "Life, physical, and social science occupations", 2022, 2023)
```

###"Lawyers" 22-23, OPV: 0.0412
```{r}
LAW_opv_3 <- get_opv(e_combined, "Lawyers", 2022, 2023)
```

###"Production, transportation, and material moving occupations" 22-23, OPV: -0.0048
```{r}
PTM_opv_3 <- get_opv(e_combined, "Production, transportation, and material moving occupations", 2022, 2023)
```

##OPV from 2023 to 2024

###"Management, business, and financial operations occupations" 23-24, OPV: 0.0019
```{r}
MBF_opv_4 <- get_opv(e_combined, "Management, business, and financial operations occupations", 2023, 2024)
```

###"Sales and related occupations" 23-24, OPV: -0.0165
```{r}
SRO_opv_4 <- get_opv(e_combined, "Sales and related occupations", 2023, 2024)
```

###"Architecture and engineering occupations" 23-24, OPV: -0.0140
```{r}
AEO_opv_4 <- get_opv(e_combined, "Architecture and engineering occupations", 2023, 2024)
```

###"Life, physical, and social science occupations" 23-24, OPV: 0.0037
```{r}
LPS_opv_4 <- get_opv(e_combined, "Life, physical, and social science occupations", 2023, 2024)
```

###"Lawyers" 23-24, OPV: -0.0368
```{r}
LAW_opv_4 <- get_opv(e_combined, "Lawyers", 2023, 2024)
```

###"Production, transportation, and material moving occupations" 23-24, OPV: -0.0057
```{r}
PTM_opv_4 <- get_opv(e_combined, "Production, transportation, and material moving occupations", 2023, 2024)
```

#OPV averages by profession: MBF: 0.02998193, SRO: -0.001380107, AEO: 0.02851566, LPS: 0.03570243, LAW: -0.007933602, PTM: 0.02177376
```{r}
MBF_opv_final <- (MBF_opv_1+MBF_opv_2+MBF_opv_3+MBF_opv_4)/4
SRO_opv_final <- (SRO_opv_1+SRO_opv_2+SRO_opv_3+SRO_opv_4)/4
AEO_opv_final <- (AEO_opv_1+AEO_opv_2+AEO_opv_3+AEO_opv_4)/4
LPS_opv_final <- (LPS_opv_1+LPS_opv_2+LPS_opv_3+LPS_opv_4)/4
LAW_opv_final <- (LAW_opv_1+LAW_opv_2+LAW_opv_3+LAW_opv_4)/4
PTM_opv_final <- (PTM_opv_1+PTM_opv_2+PTM_opv_3+PTM_opv_4)/4
```

#Visualization

##Packages
```{r}
install.packages("ggplot2")
```

```{r}
library(ggplot2)
```

##Graph of OPV by profession

###Putting OPV in dataframe format
```{r}
opv_df <- data.frame(
  occupation = c("Management, business, and financial operations occupations", "Sales and related occupations", "Architecture and engineering occupations", "Life, physical, and social science occupations", "Lawyers", "Production, transportation, and material moving occupations"),
  opv = c(MBF_opv_final, SRO_opv_final, AEO_opv_final, LPS_opv_final, LAW_opv_final, PTM_opv_final)
)
```

###Graphing
```{r}
ggplot(opv_df, aes(x = occupation, y = opv, fill = occupation)) +
  geom_col() +
  labs(
    title = "OPV Values by Occupation",
    x = "Occupation",
    y = "OPV"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = -30, hjust = 0))
```

